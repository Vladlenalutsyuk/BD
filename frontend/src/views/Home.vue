<template>
  <div class="home-page">
    <!-- –û—à–∏–±–∫–∞ -->
    <div v-if="error" class="alert alert-danger text-center">{{ error }}</div>

    <!-- –®–∞–ø–∫–∞ -->
    <header class="header">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center py-3">
          <h2 class="text-success mb-0">–î–µ—Ç—Å–∫–∏–π –¶–µ–Ω—Ç—Ä</h2>
          <div>
            <router-link to="/register" class="btn btn-dark-green me-2">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</router-link>
            <router-link to="/login" class="btn btn-outline-success">–í—Ö–æ–¥</router-link>
          </div>
        </div>
      </div>
    </header>

    <!-- –ë–∞–Ω–Ω–µ—Ä -->
    <section class="hero-section text-center">
      <div class="hero-overlay">
        <h1 class="display-4 text-white mb-4 animate__animated animate__fadeInDown">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –î–µ—Ç—Å–∫–∏–π –¶–µ–Ω—Ç—Ä!</h1>
        <p class="lead text-white mb-5 animate__animated animate__fadeInUp">
          –ú—ã –ø–æ–º–æ–≥–∞–µ–º –¥–µ—Ç—è–º —Ä–∞—Å–∫—Ä—ã—Ç—å –∏—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª —á–µ—Ä–µ–∑ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –æ–±—É—á–µ–Ω–∏–µ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.
        </p>
        <router-link to="/register" class="btn btn-dark-green btn-lg animate__animated animate__pulse animate__infinite">
          –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º!
        </router-link>
      </div>
    </section>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="content-container">
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ü–µ–Ω—Ç—Ä–µ -->
      <section class="info-section container py-5">
        <h3 class="text-center mb-4 text-success">–û –Ω–∞—à–µ–º —Ü–µ–Ω—Ç—Ä–µ</h3>
        <div class="row">
          <div class="col-md-6 mb-4 animate__animated animate__fadeInLeft">
            <div class="card shadow-lg p-4">
              <h4>–ù–∞—à–∞ –º–∏—Å—Å–∏—è</h4>
              <p>
                –ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Ç–∞–ª–∞–Ω—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞, –ø–æ–º–æ–≥–∞—è –∏–º —Ä–∞—Å—Ç–∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–º–∏, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º–∏. –ù–∞—à–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã —Å —É—á—ë—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –¥–µ—Ç–µ–π.
              </p>
            </div>
          </div>
          <div class="col-md-6 mb-4 animate__animated animate__fadeInRight">
            <div class="card shadow-lg p-4">
              <h4>–ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º</h4>
              <ul class="list-unstyled">
                <li>üë®‚Äçüè´ –£—Ä–æ–∫–∏ —Å –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —É—á–∏—Ç–µ–ª—è–º–∏</li>
                <li>üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã</li>
                <li>ü§ù –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —Ä–µ–±—ë–Ω–∫—É</li>
                <li>üì± –£–¥–æ–±–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∏—Ç–µ–ª—è—Ö -->
      <section class="teachers-section container py-5">
        <h3 class="text-center mb-4 text-success">–ù–∞—à–∏ —É—á–∏—Ç–µ–ª—è</h3>
        <div class="row">
          <div v-for="teacher in teachers" :key="teacher.id" class="col-md-4 mb-4 animate__animated animate__zoomIn">
            <div class="card shadow-lg p-4 text-center">
              <h4>{{ teacher.username }}</h4>
              <p><strong>–ü—Ä–µ–¥–º–µ—Ç:</strong> {{ teacher.subject || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
              <p><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong> {{ teacher.education || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</p>
              <p><strong>–û–ø—ã—Ç:</strong> {{ teacher.experience ? teacher.experience + ' –ª–µ—Ç' : '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
            </div>
          </div>
          <div v-if="!teachers.length" class="text-center text-muted">
            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∏—Ç–µ–ª—è—Ö –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.
          </div>
        </div>
      </section>

      <!-- –ö–∞—Ä—É—Å–µ–ª—å –æ—Ç–∑—ã–≤–æ–≤ -->
      <section class="reviews-section container py-5">
        <h3 class="text-center mb-4 text-success">–û—Ç–∑—ã–≤—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π</h3>
        <div id="reviewsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
          <div class="carousel-inner">
            <div v-for="(review, index) in reviews" :key="review.id" class="carousel-item" :class="{ active: index === 0 }">
              <div class="card shadow-sm p-4 text typhoon-center animate__animated animate__fadeIn">
                <p class="review-text">"{{ review.content }}"</p>
                <p class="review-author">‚Äî {{ review.parent_name }}, {{ formatDate(review.created_at) }}</p>
              </div>
            </div>
            <div v-if="!reviews.length" class="carousel-item active">
              <div class="card shadow-sm p-4 text-center">
                <p class="review-text">–û—Ç–∑—ã–≤—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
              </div>
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">–ü—Ä–µ–¥—ã–¥—É—â–∏–π</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#reviewsCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">–°–ª–µ–¥—É—é—â–∏–π</span>
          </button>
        </div>
        <p class="text-center mt-4">
          –•–æ—Ç–∏—Ç–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º? <router-link to="/login" class="text-success fw-bold">–í–æ–π–¥–∏—Ç–µ</router-link>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤!
        </p>
      </section>

      <!-- –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è -->
      <section class="upcoming-classes container py-5">
        <h3 class="text-center mb-4 text-success">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è</h3>
        <div class="mb-4 d-flex justify-content-center">
          <div>
            <label class="me-2">–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É:</label>
            <select v-model="selectedSubject" @change="fetchClasses" class="form-select d-inline-block w-auto">
              <option value="">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</option>
              <option v-for="subject in uniqueSubjects" :key="subject.id" :value="subject.id">
                {{ subject.name }}
              </option>
            </select>
          </div>
        </div>
        <table class="table table-striped shadow-lg">
          <thead class="table-success">
            <tr>
              <th>–ü—Ä–µ–¥–º–µ—Ç</th>
              <th>–¢–∏–ø –∑–∞–Ω—è—Ç–∏—è</th>
              <th>–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</th>
              <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
              <th>–£—á–∏—Ç–µ–ª—å</th>
              <th>–ö–∞–±–∏–Ω–µ—Ç</th>
              <th>–¶–µ–Ω–∞ (‚ÇΩ)</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="classItem in filteredClasses" :key="classItem.id" class="animate__animated animate__fadeIn">
              <td>{{ classItem.subject }}</td>
              <td>
                <span :class="classItem.class_type === 'individual' ? 'badge bg-primary' : 'badge bg-success'">
                  {{ classItem.class_type === 'individual' ? '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ' : '–ì—Ä—É–ø–ø–æ–≤–æ–µ' }}
                </span>
              </td>
              <td>
                <span v-if="classItem.class_type === 'group'">
                  {{ classItem.min_age }}-{{ classItem.max_age }} –ª–µ—Ç
                </span>
                <span v-else>-</span>
              </td>
              <td>{{ formatDate(classItem.schedule) }}</td>
              <td>{{ classItem.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
              <td>{{ classItem.room || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
              <td>{{ classItem.price || '0.00' }}</td>
            </tr>
            <tr v-if="!filteredClasses.length">
              <td colspan="7" class="text-center">–ù–µ—Ç –±–ª–∏–∂–∞–π—à–∏—Ö –∑–∞–Ω—è—Ç–∏–π</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer py-4 text-center">
      <p class="mb-0">¬© 2025 –î–µ—Ç—Å–∫–∏–π –¶–µ–Ω—Ç—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  name: 'HomePage',
  data() {
    return {
      classes: [],
      subjects: [],
      selectedSubject: '',
      reviews: [],
      teachers: [],
      error: null,
    };
  },
  computed: {
    uniqueSubjects() {
      return this.subjects;
    },
    filteredClasses() {
      let filtered = this.classes;
      if (this.selectedSubject) {
        filtered = filtered.filter(cls => cls.subject_id === parseInt(this.selectedSubject));
      }
      const now = new Date();
      return filtered
        .filter(cls => new Date(cls.schedule) > now)
        .sort((a, b) => new Date(a.schedule) - new Date(b.schedule));
    },
  },
  methods: {
    async fetchSubjects() {
      try {
        const response = await axios.get('http://localhost:3000/api/subjects');
        this.subjects = response.data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
        this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã';
      }
    },
    async fetchClasses() {
      try {
        const response = await axios.get('http://localhost:3000/api/classes/public');
        this.classes = response.data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–Ω—è—Ç–∏–π:', error);
        this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω—è—Ç–∏—è';
      }
    },
    async fetchReviews() {
      try {
        const response = await axios.get('http://localhost:3000/api/reviews');
        this.reviews = response.data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Ç–∑—ã–≤–æ–≤:', error);
        this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–∑—ã–≤—ã';
      }
    },
    async fetchTeachers() {
      try {
        const response = await axios.get('http://localhost:3000/api/users/teachers/public');
        this.teachers = response.data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—á–∏—Ç–µ–ª–µ–π:', error);
        this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—á–∏—Ç–µ–ª—è—Ö';
      }
    },
    formatDate(date) {
      return new Date(date).toLocaleString('ru-RU');
    },
  },
  mounted() {
    this.fetchSubjects();
    this.fetchClasses();
    this.fetchReviews();
    this.fetchTeachers();
  },
};
</script>

<style scoped>
.home-page {
  min-height: 100vh;
  background-color: #f0f8f0;
  font-family: 'Comic Sans MS', 'Segoe UI', sans-serif;
}

.header {
  background-color: #fff;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.hero-section {
  background-image: url('https://images.unsplash.com/photo-1516321497487-e288fb19713f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
  background-size: cover;
  background-position: center;
  height: 600px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.hero-overlay {
  background-color: rgba(0, 0, 0, 0.5);
  padding: 40px;
  border-radius: 15px;
}

.hero-section h1 {
  font-size: 3.5rem;
  font-weight: bold;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.hero-section p {
  font-size: 1.5rem;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

.content-container {
  padding: 0;
}

.info-section .card,
.teachers-section .card,
.reviews-section .card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: none;
  border-radius: 15px;
  background-color: #fff;
}

.info-section .card:hover,
.teachers-section .card:hover,
.reviews-section .card:hover {
  transform: translateY(-10px);
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

.btn-dark-green {
  background-color: #2e7d32;
  color: white;
  border: none;
  padding: 12px 30px;
  border-radius: 25px;
  font-size: 1.2rem;
  transition: background-color 0.3s ease, transform 0.3s ease;
}

.btn-dark-green:hover {
  background-color: #256528;
  transform: scale(1.05);
}

.reviews-section .carousel-item {
  transition: opacity 0.5s ease-in-out;
}

.review-text {
  font-style: italic;
  color: #555;
  font-size: 1.1rem;
}

.review-author {
  font-weight: bold;
  color: #2e7d32;
}

.carousel-control-prev,
.carousel-control-next {
  width: 5%;
}

.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-color: #2e7d32;
  border-radius: 50%;
  padding: 20px;
}

.table {
  background: #f8f9fa;
  border-radius: 15px;
  overflow: hidden;
}

.table-striped tbody tr:nth-of-type(odd) {
  background-color: rgba(0, 0, 0, 0.05);
}

.table thead {
  background-color: #2e7d32;
  color: white;
}

.badge {
  font-size: 0.9em;
  padding: 0.5em 1em;
  border-radius: 20px;
}

.footer {
  background-color: #fff;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  color: #555;
}
</style>